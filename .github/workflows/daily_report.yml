name: Daily GitHub Trending Report

on:
  schedule:
    - cron: '0 0 * * *' # Daily at midnight UTC
  workflow_dispatch:
    inputs:
      language:
        description: 'Programming language to search'
        required: true
        default: 'dart'

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: dart-lang/setup-dart@v1
        with:
          sdk: stable

      - name: Install dependencies
        run: dart pub get

      - name: Build AOT
        run: dart compile exe bin/main.dart -o github_trend_summary

      - name: Run Report
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          ./github_trend_summary \
            --lang ${{ github.event.inputs.language || 'dart' }} \
            --gemini-key $GEMINI_API_KEY \
            --github-token $GITHUB_TOKEN \
            --output report.md

      - name: Upload Report
        uses: actions/upload-artifact@v3
        with:
          name: trending-report
          path: report.md

      - name: Print Report to Console
        run: cat report.md
